<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.example.controller.trabajador.MisEstadisticasController"
            style="-fx-background-color: #ecf0f1;">

    <!-- HEADER -->
    <top>
        <VBox spacing="15" style="-fx-background-color: #34495e; -fx-padding: 20;">
            
            <!-- TÃ­tulo -->
            <Label text="ðŸ“Š Mis EstadÃ­sticas"
                   style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: white;"/>

            <!-- Filtros -->
            <HBox spacing="15" alignment="CENTER_LEFT">
                <Label text="Mes:" style="-fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                <ComboBox fx:id="cbMes" prefWidth="140" style="-fx-font-size: 14px;"/>

                <Label text="AÃ±o:" style="-fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                <ComboBox fx:id="cbAnio" prefWidth="100" style="-fx-font-size: 14px;"/>

                <Button fx:id="btnBuscar"
                        text="ðŸ” Buscar"
                        onAction="#handleBuscar"
                        style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 8 20; -fx-cursor: hand; -fx-font-weight: bold;"/>

                <Region HBox.hgrow="ALWAYS"/>

                <Button fx:id="btnVolver"
                        text="â¬…ï¸ Volver"
                        onAction="#handleVolver"
                        style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 8 20; -fx-cursor: hand; -fx-font-weight: bold;"/>
            </HBox>
        </VBox>
    </top>

    <!-- CONTENIDO PRINCIPAL CON PESTAÃ‘AS -->
    <center>
        <TabPane fx:id="tabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: transparent;">

            <!-- ============================================ -->
            <!-- TAB 1: ESTADÃSTICAS MENSUALES -->
            <!-- ============================================ -->
            <Tab fx:id="tabMensual" text="ðŸ“… Mensual">
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                    <VBox spacing="20" style="-fx-padding: 20;">

                        <!-- Tarjetas de Resumen -->
                        <HBox spacing="15" alignment="CENTER">
                            
                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="â±ï¸ Total Horas" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblMensualTotal" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“Š Promedio Diario" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblMensualPromedio" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“… DÃ­as Trabajados" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblMensualDias" text="0" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ”¥ DÃ­a MÃ¡ximo" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblMensualMax" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                            </VBox>
                            
                        </HBox>

                        <!-- GrÃ¡fico de Barras -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“ˆ EvoluciÃ³n Diaria" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <BarChart fx:id="chartMensualBarras" prefHeight="300" legendVisible="false">
                                <xAxis>
                                    <CategoryAxis fx:id="xAxisMensual" label="Fecha" side="BOTTOM"/>
                                </xAxis>
                                <yAxis>
                                    <NumberAxis fx:id="yAxisMensual" label="Horas" side="LEFT" autoRanging="true"/>
                                </yAxis>
                            </BarChart>
                        </VBox>

                        <!-- Tabla Detalle -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“‹ Detalle por DÃ­a" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <TableView fx:id="tableMensual" prefHeight="300">
                                <columns>
                                    <TableColumn fx:id="colDiaFecha" text="Fecha" prefWidth="140"/>
                                    <TableColumn fx:id="colDiaSemana" text="DÃ­a Semana" prefWidth="140"/>
                                    <TableColumn fx:id="colDiaHoras" text="Total Horas" prefWidth="120"/>
                                    <TableColumn fx:id="colDiaEstado" text="Estado" prefWidth="140"/>
                                </columns>
                            </TableView>
                        </VBox>

                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- ============================================ -->
            <!-- TAB 2: ESTADÃSTICAS SEMANALES -->
            <!-- ============================================ -->
            <Tab fx:id="tabSemanal" text="ðŸ“† Semanal">
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                    <VBox spacing="20" style="-fx-padding: 20;">

                        <!-- Tarjetas de Resumen -->
                        <HBox spacing="15" alignment="CENTER">
                            
                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="â±ï¸ Total Horas" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblSemanalTotal" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“Š Promedio Semanal" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblSemanalPromedio" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“… Semanas" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblSemanalSemanas" text="0" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ† Mejor Semana" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblSemanalMejor" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #f39c12;"/>
                            </VBox>
                            
                        </HBox>

                        <!-- GrÃ¡ficos -->
                        <HBox spacing="15">
                            
                            <!-- GrÃ¡fico de Barras -->
                            <VBox spacing="10" HBox.hgrow="ALWAYS"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“Š ComparaciÃ³n Semanal" 
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                                <BarChart fx:id="chartSemanalBarras" prefHeight="300" legendVisible="false">
                                    <xAxis>
                                        <CategoryAxis fx:id="xAxisSemanal" label="Semana" side="BOTTOM"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis fx:id="yAxisSemanal" label="Horas" side="LEFT" autoRanging="true"/>
                                    </yAxis>
                                </BarChart>
                            </VBox>

                            <!-- GrÃ¡fico Circular -->
                            <VBox spacing="10" prefWidth="400"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ• DistribuciÃ³n Semanal" 
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                                <PieChart fx:id="chartSemanalPie" prefHeight="300" legendSide="BOTTOM"/>
                            </VBox>
                            
                        </HBox>

                        <!-- Tabla Detalle -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“‹ Detalle por Semana" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <TableView fx:id="tableSemanal" prefHeight="200">
                                <columns>
                                    <TableColumn fx:id="colSemanaNumero" text="Semana" prefWidth="100"/>
                                    <TableColumn fx:id="colSemanaRango" text="Rango Fechas" prefWidth="150"/>
                                    <TableColumn fx:id="colSemanaDias" text="DÃ­as Trabajados" prefWidth="140"/>
                                    <TableColumn fx:id="colSemanaTotal" text="Total Horas" prefWidth="130"/>
                                    <TableColumn fx:id="colSemanaPromedio" text="Promedio/DÃ­a" prefWidth="130"/>
                                </columns>
                            </TableView>
                        </VBox>

                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- ============================================ -->
            <!-- TAB 3: ESTADÃSTICAS ANUALES -->
            <!-- ============================================ -->
            <Tab fx:id="tabAnual" text="ðŸ“Š Anual">
                <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
                    <VBox spacing="20" style="-fx-padding: 20;">

                        <!-- Tarjetas de Resumen -->
                        <HBox spacing="15" alignment="CENTER">
                            
                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="â±ï¸ Total AÃ±o" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAnualTotal" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“Š Promedio Mensual" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAnualPromedio" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ“… Meses Activos" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAnualMeses" text="0" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                            </VBox>

                            <VBox alignment="CENTER" spacing="5" prefWidth="200" prefHeight="100"
                                  style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                                <Label text="ðŸ† Mejor Mes" style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAnualMejor" text="0.00 h" 
                                       style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #9b59b6;"/>
                            </VBox>
                            
                        </HBox>

                        <!-- GrÃ¡fico de Barras -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“Š Total por Mes" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <BarChart fx:id="chartAnualBarras" prefHeight="300" legendVisible="false">
                                <xAxis>
                                    <CategoryAxis fx:id="xAxisAnual" label="Mes" side="BOTTOM"/>
                                </xAxis>
                                <yAxis>
                                    <NumberAxis fx:id="yAxisAnual" label="Horas" side="LEFT" autoRanging="true"/>
                                </yAxis>
                            </BarChart>
                        </VBox>

                        <!-- GrÃ¡fico de LÃ­neas -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“ˆ EvoluciÃ³n Anual" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <LineChart fx:id="chartAnualLinea" prefHeight="300" legendVisible="false">
                                <xAxis>
                                    <CategoryAxis fx:id="xAxisAnualLinea" label="Mes" side="BOTTOM"/>
                                </xAxis>
                                <yAxis>
                                    <NumberAxis fx:id="yAxisAnualLinea" label="Horas" side="LEFT" autoRanging="true"/>
                                </yAxis>
                            </LineChart>
                        </VBox>

                        <!-- Tabla Detalle -->
                        <VBox spacing="10"
                              style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                            <Label text="ðŸ“‹ Detalle por Mes" 
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <TableView fx:id="tableAnual" prefHeight="300">
                                <columns>
                                    <TableColumn fx:id="colMes" text="Mes" prefWidth="150"/>
                                    <TableColumn fx:id="colMesDias" text="DÃ­as Trabajados" prefWidth="150"/>
                                    <TableColumn fx:id="colMesTotal" text="Total Horas" prefWidth="150"/>
                                    <TableColumn fx:id="colMesPromedio" text="Promedio/DÃ­a" prefWidth="150"/>
                                </columns>
                            </TableView>
                        </VBox>

                    </VBox>
                </ScrollPane>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
